# CI

Для запуска сервера нужно глабально установить ts-node т.к. писалось на typescript:
`npm i -g ts-node`

Как и было рекомендовано сделать две папки, так и реализовал папку для сервера и папку для агента.

# Сервер

Порт для сервера передается через аргумент `--path=3000` как пример. Результат работы складывается рядом в папку `data_base/results/`.
В качестве идешников билдов использую timestamp с миллисекундами, при небольшой частоте запусков этого достаточно.
Информация хранится в xml файлах.
Агент выбирается случайным образом, если их несколько, а если один, то логично что будет идти только туда )))

На главной странице отображается форма для приема задания на сборку, все поля обязательны.
Ниже список с билдами будет. При запуске сборки происходит редирект на эту сборку.

Папка:
`/server`

Запуск:
- `npm install`
- `npm run start`

## Агенты

Запускать агентов можно много, указывая новый порт для их работы и параметры для сервера.
При запуске он по указанным параметрам реистрируется на сервере.
При отключениях/падениях (постарался отследить возможные ситуации) отправляется сигнал о прекращении работы с агентом серверу.
Обработку команд может быть сделал не очень полноценно, т.к. хотел использовать make, но не успел заюзать, но команды выполняются ))

Агент может принимать много задач на сборку, но будет выполнять по одному, остальные будут ложиться в очередь.
Для работы агента используется папка tmp, в которой создается папка с билдом, по завершении удаляется.

Папка:
`/agent`

Запуск:
- `npm install`
- `npm run start`

#### Как обрабатывает сборку агент

- Агент создает папку по ид сборки
- В папку сборки клонирует репозиторий
- Происходит checkout на указанный, коммит. Работает именно по хэшу комита
- Запускает команду указаную в задании для сборки
- После окончания отправляется результат на сервер
- Удаляется временная папка 
